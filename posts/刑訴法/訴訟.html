<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.556">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Legal Dragoman - 刑事訴訟法（訴訟）</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../サンショウウオ.jpg" rel="icon" type="image/jpeg">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "?",
    "H"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Legal Dragoman - 刑事訴訟法（訴訟）">
<meta property="og:image" content="https://Legal-Dragoman.github.io/posts/刑訴法/サンショウウオ.jpg">
<meta property="og:site_name" content="Legal Dragoman">
<meta name="twitter:title" content="Legal Dragoman - 刑事訴訟法（訴訟）">
<meta name="twitter:image" content="https://Legal-Dragoman.github.io/posts/刑訴法/サンショウウオ.jpg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Legal Dragoman</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
    <a href="https://github.com/Legal-Dragoman/Legal-Dragoman.github.io/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#公訴の提起" id="toc-公訴の提起" class="nav-link active" data-scroll-target="#公訴の提起"><span class="header-section-number">1</span> 公訴の提起</a></li>
  <li><a href="#訴因の特定明示" id="toc-訴因の特定明示" class="nav-link" data-scroll-target="#訴因の特定明示"><span class="header-section-number">2</span> 訴因の特定・明示</a></li>
  <li><a href="#訴因変更" id="toc-訴因変更" class="nav-link" data-scroll-target="#訴因変更"><span class="header-section-number">3</span> 訴因変更</a>
  <ul class="collapse">
  <li><a href="#訴因変更の要否" id="toc-訴因変更の要否" class="nav-link" data-scroll-target="#訴因変更の要否"><span class="header-section-number">3.1</span> 訴因変更の要否</a></li>
  <li><a href="#訴因変更の可否" id="toc-訴因変更の可否" class="nav-link" data-scroll-target="#訴因変更の可否"><span class="header-section-number">3.2</span> 訴因変更の可否</a></li>
  <li><a href="#訴因変更の許否" id="toc-訴因変更の許否" class="nav-link" data-scroll-target="#訴因変更の許否"><span class="header-section-number">3.3</span> 訴因変更の許否</a></li>
  <li><a href="#訴因変更命令" id="toc-訴因変更命令" class="nav-link" data-scroll-target="#訴因変更命令"><span class="header-section-number">3.4</span> 訴因変更命令</a></li>
  </ul></li>
  <li><a href="#証拠の関連性" id="toc-証拠の関連性" class="nav-link" data-scroll-target="#証拠の関連性"><span class="header-section-number">4</span> 証拠の関連性</a>
  <ul class="collapse">
  <li><a href="#前科証拠" id="toc-前科証拠" class="nav-link" data-scroll-target="#前科証拠"><span class="header-section-number">4.1</span> 前科証拠</a></li>
  <li><a href="#科学的証拠" id="toc-科学的証拠" class="nav-link" data-scroll-target="#科学的証拠"><span class="header-section-number">4.2</span> 科学的証拠</a></li>
  </ul></li>
  <li><a href="#自白の証拠能力" id="toc-自白の証拠能力" class="nav-link" data-scroll-target="#自白の証拠能力"><span class="header-section-number">5</span> 自白の証拠能力</a></li>
  <li><a href="#伝聞証拠" id="toc-伝聞証拠" class="nav-link" data-scroll-target="#伝聞証拠"><span class="header-section-number">6</span> 伝聞証拠</a>
  <ul class="collapse">
  <li><a href="#伝聞例外" id="toc-伝聞例外" class="nav-link" data-scroll-target="#伝聞例外"><span class="header-section-number">6.1</span> 伝聞例外</a></li>
  </ul></li>
  <li><a href="#違法収集証拠" id="toc-違法収集証拠" class="nav-link" data-scroll-target="#違法収集証拠"><span class="header-section-number">7</span> 違法収集証拠</a></li>
  <li><a href="#裁判" id="toc-裁判" class="nav-link" data-scroll-target="#裁判"><span class="header-section-number">8</span> 裁判</a>
  <ul class="collapse">
  <li><a href="#概括的認定択一的認定" id="toc-概括的認定択一的認定" class="nav-link" data-scroll-target="#概括的認定択一的認定"><span class="header-section-number">8.1</span> 概括的認定・択一的認定</a></li>
  <li><a href="#一事不再理効" id="toc-一事不再理効" class="nav-link" data-scroll-target="#一事不再理効"><span class="header-section-number">8.2</span> 一事不再理効</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">刑事訴訟法（訴訟）</h1>
  <div class="quarto-categories">
    <div class="quarto-category">刑事訴訟法</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">3/04/2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="公訴の提起" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="公訴の提起"><span class="header-section-number">1</span> 公訴の提起</h2>
<ul>
<li>審判対象を選択するのは、検察官（訴追裁量権・起訴独占主義、刑訴法248条）。
<ul>
<li>裁判所も検察官の訴因選択に拘束されて、訴因に記載された犯罪事実に限って審判する。それに応じて、被告人・弁護人も審判対象たる訴因以外の事実については、主張することができない。</li>
</ul></li>
<li>訴因外の事実について審理するか？
<ul>
<li>訴因記載の犯罪の成立を妨げる事情は、訴因外の事実であっても審理の対象となる（実体法的解釈に依存する）。</li>
<li>単独正犯を訴因とする事件で、訴因外の事実として共謀者がいる場合</li>
</ul>
<blockquote class="blockquote">
<p>「<u>被告人1人の行為により犯罪構成要件のすべてが満たされたと認められるとき</u> は、 他に共謀共同正犯者が存在するとしてもその犯罪の成否は左右されない」</p>
</blockquote>
<span class="color-minty"><i class="fa-solid fa-arrow-left" aria-label="arrow-left"></i></span> この意味で、刑法60条には、①実行行為の全部を行っていない者が正犯として責任を負うために適用される場合と②単独正犯としても責任を問い得るが、他人との共謀があるために適用される場合とがある。</li>
<li>量刑上の不利益をもたらす一部起訴　e.g., かすがい現象
<ul>
<li>被告人の不利益になるような訴因の設定は <u>検察官の訴追権を逸脱して違法である</u> とする見解
<ul>
<li>訴因変更が必要となるとする立場が一方である。</li>
<li>罪数判断のために考慮するだけであれば、その事実について被告人を有罪として処罰するわけでないから、訴因変更手続を経なくとも訴因外の事実を考慮できるとする立場もある。</li>
</ul></li>
<li>このような一部起訴も許されるとする見解 <span class="color-minty"><i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i></span> 訴因外の事実は考慮できないため、量刑の場面で、一罪として処罰する場合の処断刑の範囲内で刑を言い渡さなければならない。</li>
</ul></li>
</ul>
</section>
<section id="訴因の特定明示" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="訴因の特定明示"><span class="header-section-number">2</span> 訴因の特定・明示</h2>
<ul>
<li><p>起訴状の記載事項である「公訴事実」（256条2項）</p>
<ul>
<li>公訴事実は訴因を明示して記載しなければならない。</li>
</ul></li>
<li><p>訴因：訴因には六何の原則に従った事項だけではなく、構成要件の修正形式である共犯や未遂に該当する事実も含まれる。</p>
<ul>
<li>犯罪の主体・客体・行為と結果 <span class="color-minty"><i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i></span> それ自体「罪となるべき事実」であると共に、その具体的記載によって訴因が特定される。</li>
<li>日時・場所・方法 <span class="color-minty"><i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i></span> 犯罪の構成要素となっている場合を除き、「罪となるべき事実」には当たらない。しかし、訴因を特定する手段となる。</li>
</ul></li>
<li><p>特定の趣旨（識別説と防御権説）</p>
<ul>
<li>①裁判所に対して審判の対象を限定する</li>
<li>②被告人に対して防御の範囲を示す</li>
</ul></li>
<li><p>訴因の特定の判断基準</p>
<p>【絶対的要請】 1. 「罪となるべき事実」の記載</p>
<pre><code>  cf. 有罪判決の場面と共通の問題

  ①特定の構成要件

  ②全ての構成要件要素　

  ③事実の具体性（反証をおよそ不可能にするか）

  2. 他の犯罪との識別　「特定」できているか？</code></pre>
<p>【相対的要請】</p>
<p>「できる限り」＝特殊事情の存在</p>
<p>「犯罪の種類、性質等のいかんにより、これを詳らかにできない特殊事情がある場合」</p></li>
<li><p>特別な構成要件（？）からの要請</p>
<ul>
<li>過失犯における「過失の態様」の位置付け</li>
</ul>
<p><span class="color-minty"><i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i></span> ②の問題とするか、③の問題とするか（構成要件要素と捉えるかどうかによる）</p>
<ul>
<li>連続的包括一罪：「単一の意思」と「共通ないし類似した態様の行為」が構成要件とされる
<ul>
<li>被害者を明示し、一定期間内に行われた実行行為をまとめて一罪として構成することによって、他の犯罪と区別することができる。</li>
<li>構成要件であると解すると、個々の傷害行為について特定されていないとしても、共通ないし類似した傷害行為が継続して行われていたことが示されていれば、構成要件要素については十分に示されていると言える。訴因の記載の仕方からしておよそ証明不可能であると言えるほどまでに不明確であるわけでもない。</li>
</ul></li>
<li>共同正犯
<ul>
<li>共謀の日時、場所は訴因の特定に不可欠な事実ではない。</li>
<li>実行行為者が誰かは共同正犯の成否に関係ない。</li>
</ul></li>
<li>覚醒剤使用等の罪
<ul>
<li>最終行為説、最低一行為説による特定</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="訴因変更" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="訴因変更"><span class="header-section-number">3</span> 訴因変更</h2>
<section id="訴因変更の要否" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="訴因変更の要否"><span class="header-section-number">3.1</span> 訴因変更の要否</h3>
<ul>
<li>第1段階：訴因の特定のために不可欠な事項か？（裁判所が審判対象を変更し、検察官の訴因設定権を奪ってはならない）
<ul>
<li>訴因の識別機能とリンクする</li>
<li>第一段階には例外はない</li>
</ul></li>
<li>第2段階：被告人の防御にとって重要なのか？ （争点明確化のために書き込まれた事項について、被告人の不意打ち防止を図る）
<ul>
<li>一般的に被告人の防御にとって重要な事項については、争点の明確化などのために実行行為者を明示するのが望ましい。明示した場合には、原則としてそれと異なる事実認定をする場合に訴因変更手続を要する。</li>
<li>第2段階の例外：ただし、被告人の防御の具体的な状況等の審理の経過に照らし、
<ul>
<li>①被告人に不意打ちを与えるものではないと認められ、かつ、</li>
<li>②判決で認定される事実が被告人にとってより不利益であるとは言えない場合には、例外的に、訴因変更手続を経る必要がない。</li>
</ul></li>
<li>訴因の防御範囲を示す機能とリンクするとも。しかし、訴因の機能は両者一体となっていると解する立場に立てば、第２段階では異なる立場になるのではないか。むしろ、訴訟全般で要求される争点の明確化に伴う不意打ち防止の要請が趣旨なのではないか。</li>
</ul></li>
<li>「訴因の記載として不可欠な事項」について異なる事実認定をした場合（第一段階の問題）には、不告不利原則違反として378条3号の絶対的控訴理由に該当するのに対して、訴因の記載として必須ではない事項について（第二段階の問題）は、379条違反として相対的控訴理由となる。</li>
</ul>
</section>
<section id="訴因変更の可否" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="訴因変更の可否"><span class="header-section-number">3.2</span> 訴因変更の可否</h3>
<ul>
<li>「公訴事実の同一性を害しない限度において」（刑訴312条1項）検察官の訴因変更請求を許さなければならない。</li>
<li>①公訴事実の単一性＋②（狭義の）公訴事実の同一性
<ul>
<li>単一性は、訴訟係属中2つの時点で比較する場合と特定の時点で2つの事実を比較する場合とで同様に問題になる。両事実が実体法上の一罪を構成すれば、公訴事実の同一性が認められる。</li>
<li>狭義の同一性は、両事実が実体法上の一罪を構成しないけれども、公訴事実の同一性が認められる場合。</li>
</ul>
<span class="color-minty"><i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i></span> 基本的事実関係の同一性によって判断 （事実上の共通性が弱い場合にも、非両立性を相補的に考慮）</li>
<li>「非両立性」の意味
<ul>
<li>事実の両立可能性（香城説）</li>
</ul>
<span class="color-minty"><i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i></span> 同一の社会的事実に帰属するものか
<ul>
<li>実体法上の両立可能性（大澤説）</li>
</ul>
<span class="color-minty"><i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i></span> 同一刑罰権に対する二重処罰に当たるかどうか</li>
</ul>
</section>
<section id="訴因変更の許否" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="訴因変更の許否"><span class="header-section-number">3.3</span> 訴因変更の許否</h3>
<ul>
<li><u>公訴事実の同一性の範囲内であったとしても</u> 、訴因変更に制約を課すべき場合がないか？</li>
<li>訴因変更に伴い、被告人に重大な不利益が生じる場合：訴因変更の時機
<ul>
<li>被告人に十分な防御の準備をさせるために公判手続を停止（312条4項）</li>
<li>訴因変更によって、被告人が新たな訴因につき防御を強いられることになるとしても、そのことだけで訴因変更が許されなくなるわけではなく、＋αが必要。</li>
</ul>
<span class="color-minty"><i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i></span> ①訴因変更の時期・段階、②両訴因の関係（訴因の骨格となる事実関係の共通性）、③審理の経過（検察官の立証の経過、被告人側の防御の内容とその程度）、④被告人に対する不意打ちの程度、変更後に予想される被告人側の不利益・負担の程度、⑤事案の重大性 などに鑑みて<u>、訴因変更請求が検察官の誠実な権利の行使と認められないような場合</u> があり得る。</li>
<li>訴因変更により実体的真実の解明とそれに基づく処罰が妨げられる場合：変更前の訴因が成立する場合の訴因変更
<ul>
<li>最高裁の判例はまだない。</li>
<li>刑法312条1項+検察官に起訴猶予権限（248）・公訴取消権限（257）→訴因変更の場面でも、検察官がそもそも処罰を求めないのであれば裁判所はそれに従うべき？</li>
</ul></li>
</ul>
</section>
<section id="訴因変更命令" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="訴因変更命令"><span class="header-section-number">3.4</span> 訴因変更命令</h3>
<ul>
<li>訴因変更命令・勧告の義務が認められる場合があるか？
<ul>
<li>仮にあると尽くさなかった場合には審理不尽によって当該措置は違法となる。</li>
<li>当事者主義の構造</li>
</ul>
but 重大な犯罪について訴因変更すれば有罪となることが明白であるような場合には、著しく正義に反する結果が生じるとして、訴因変更命令が義務的になる。
<ul>
<li>ただし、犯罪の重大性と証拠の明白性だけでなく、<u>検察官の訴追意思や被告人の防御上の利益などの手続上の要素、および事案の性質・内容、被告人の花校への関与の程度、共犯者との処分の均衡</u> などの実体面における要素も考慮している（最判昭和58年9月6日参照）。</li>
</ul></li>
</ul>
</section>
</section>
<section id="証拠の関連性" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="証拠の関連性"><span class="header-section-number">4</span> 証拠の関連性</h2>
<section id="前科証拠" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="前科証拠"><span class="header-section-number">4.1</span> 前科証拠</h3>
<ul>
<li><p>関連性否定の趣旨（自然的関連性まで否定されるわけでない）</p></li>
<li><p>「前科に係る犯罪事実が顕著な特徴を有し、かつ、それが起訴に係る犯罪事実と相当程度類似する」場合には、前科証拠を被告人と犯人の同一性を証明するために用いることが許される。</p>
<ul>
<li>顕著な特徴を有する前科犯罪事実と同じ犯罪事実であるならば、悪性格の推認を介在させずに犯人性を推認できるから。</li>
</ul></li>
<li><p>「行動傾向の固着化」や「強固な犯罪傾向」に対する考え方</p>
<ul>
<li>他に選択の余地がないほどに強固に習慣化しているか、被告人の性格の中に根付いているといえる程度があれば、前科証拠を利用できるとする立場を認めて良いか？</li>
<li>被告人の犯罪性向を介した推認だとしても、推認力が相当程度に大きい場合には多少弊害があっても比較衡量したら満たされるというふうに考える余地も出てくるのではないか？というのが近時の有力説。</li>
</ul></li>
<li><p>注意：「顕著な特徴」と「強固な犯罪傾向」の違い（基礎にある経験則）</p>
<ul>
<li>顕著な特徴：その人以外がやった可能性がない、その人しかできないというような手法である（第三者がやった可能性を排斥する方向の推認）</li>
<li>強固な犯罪傾向：その人自身が特定の状況下において一定の行動に出る可能性が高いので本件犯行をやった可能性が高いという方向の推認</li>
</ul></li>
<li><p>①被告人の犯罪性向といった実証的根拠に乏しい人格評価につながりやすく、そのために事実認定を誤らせるおそれがあること</p>
<p>「過去の同種犯罪事実」→「被告人の犯罪性向・悪性格」→「本件犯罪における犯人性」という推認過程</p>
<p>2個目の推認について、裁判官が被告人に対する安直な偏見を持って判断し、<u>推認力が過大評価されてしまう危険</u> がある。</p></li>
<li><p>②当事者が前科の内容に立ち入った攻撃防御を行う必要が生じるなど、その <u>取り調べに付随して争点が拡散するおそれ</u> がある。</p></li>
<li><p>同種事件が併合審理されている場合に、①②のいずれも妥当するのか？（金築裁判官の指摘）</p></li>
</ul>
</section>
<section id="科学的証拠" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="科学的証拠"><span class="header-section-number">4.2</span> 科学的証拠</h3>
<ul>
<li><p>「科学的証拠」に対して過信し、証拠力を過大評価する恐れ</p></li>
<li><p>DNA鑑定</p>
<p>①「科学的原理が理論的正確性を有し、具体的な実施の方法も、その技術を習得した者により、科学的に信頼される方法で行われた」（抽象的な信頼性）</p>
<p>②本件事案における具体的な実施方法の適切性</p></li>
<li><p>犬の臭気選別試験</p>
<p><span class="color-minty"><i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i></span> 以下から証拠能力を認めた（科学的原理の理論的正確性は未だ不明確・解明されてもいないので専門化した経験則を噛ませている）。</p>
<ul>
<li>専門的な知識・経験を有する指導手が行ったこと</li>
<li>臭気選別能力が優れ、選別時において体調等も良好でその能力がよく保持されている警察犬を使用して実施したこと</li>
<li>臭気の採取、保管の過程、臭気選別方法に不適切な点がないこと</li>
</ul></li>
</ul>
</section>
</section>
<section id="自白の証拠能力" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="自白の証拠能力"><span class="header-section-number">5</span> 自白の証拠能力</h2>
<ul>
<li>不任意自白の排除を要求する趣旨
<ul>
<li>人権擁護説：意思決定の自由や黙秘権を侵害したら自白の任意性が疑われるという考え方</li>
</ul>
（→約束による自白を捕捉できない）
<ul>
<li>虚偽排除説：<u>強い利益誘導の下でなされた自白</u> は、一般的類型的に虚偽である疑いが高まるので証拠能力が否定されるという考え方</li>
</ul>
<span class="color-minty"><i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i></span> 供述状況に着目して一般的類型的に虚偽自白が誘発されやすい状況かどうかを判断する
<ul>
<li>違法排除説：手続の適正の確保（司法の廉潔性、将来違法捜査の抑止）の観点から自白が排除されるという考え方</li>
</ul></li>
<li><u>利益の提供主体と提示された具体的利益</u> の両方を見る。</li>
<li>派生証拠（違法収集証拠排除法則の適用）
<ul>
<li>虚偽排除説から根拠づけようとすると難しい面。</li>
<li>違法収集証拠排除法則は、供述証拠に対しても適用されるから、手続の違法が重大であり、これを証拠とすることが違法捜査抑止の見地から相当でない場合には、証拠能力を否定する。</li>
<li>ただし、物的証拠に対する違法収集証拠排除法則の基準との関係性はなお問題。</li>
</ul></li>
<li>問題の処理
<ul>
<li>現在は自白に対しては自白法則と違法収集証拠排除法則の両方が適用されるとする考え方が支配的で、その上で実務では一般的に二元説といった考え方が取られる。</li>
<li>まず <u>自白法則は虚偽排除と人権擁護だけで説明する（任意性説）</u> 。これに対して、手続の違法問題は全部、違法収集証拠排除法則で考える。このように、ある種自白法則と違法収集排除法則の根拠を完全に住み分けてしまう見解というのが実務では支配的である。</li>
</ul></li>
</ul>
</section>
<section id="伝聞証拠" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="伝聞証拠"><span class="header-section-number">6</span> 伝聞証拠</h2>
<ul>
<li>伝聞証拠排除の趣旨（伝聞と非伝聞）
<ul>
<li>供述者の <strong>知覚、記憶、叙述</strong> という過程を経て供述されるところ、誤りが介在する恐れ</li>
<li>公判廷において、宣誓、反対尋問、裁判官による供述態度の観察によって誤りを排除することができない</li>
</ul></li>
<li>要証事実（当該証拠によって直接証明しようとする事実）が何か？
<ul>
<li>要証事実との関係で、<strong>供述内容の真実性</strong> を立証しようとする場合には、伝聞証拠となる。</li>
<li>精神状態に対する供述が伝聞証拠に当たらない理由
<ul>
<li>内心の事情は、<strong>知覚・記憶の過程</strong> が欠如しているため、非伝聞と評価されるのが通説（表現の真摯性・叙述に誤りが入る可能性については、公判廷で確認できる）。</li>
<li>伝聞証拠だとしてしまうと、本人の供述が最高の証拠で何としても採用したいとする場合には324条の準用する321条1項3号になる。あまりに重すぎ。</li>
<li>非供述的用法の場合には、発言をしたこと自体が要証事実になる（謀議の場合など）。この場合にも、真摯性が問題になる（非伝聞証拠でも関連性が問題になる）。</li>
</ul></li>
<li>犯行計画メモ：犯行の意思・計画を要証事実とした場合には、知覚・記憶の部分が欠落している犯行計画メモについては、その作成が真摯になされたことが証明されれば、その信用性をテストする必要はない。</li>
<li>謀議参加者の1人が合意された結果を書き留めた書面
<ul>
<li>共謀加担者の意図・計画は独立して存在するので、全員の心理状態が記述されていると見るには状況を限定する必要がある。</li>
<li>最低限記述者の意図しか示していない。しかし、その場にいた全員の意思が合致していることを別途立証できれば証拠として利用できるのでは（署名など）。</li>
<li>共同意思形成をする上で用いられた手段を構成する証拠物としての利用</li>
</ul></li>
</ul></li>
<li>検察官の立証事項を維持すると伝聞証拠に当たり原則として証明能力が求められないことになる場合には、<u>対象証拠それ自体から直接抽き出しうる限度に立証事項を裁判所が減縮することができる</u> としている。
<ul>
<li>一次的には検察官の立証趣旨を尊重し（⇦当事者主義）、そのままだと証拠能力が認められなくなってしまうという場合に、二次的に立証事項が変更される。</li>
<li>検察官が主張する要証事実であると、およそ推認過程が経験則で成り立たないという場合には自然的関連性が否定されるので、裁判所が適切な要証事実を設定する必要がある。</li>
</ul></li>
</ul>
<section id="伝聞例外" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="伝聞例外"><span class="header-section-number">6.1</span> 伝聞例外</h3>
<ul>
<li><p>検察官調書（321条1項2号）</p>
<ul>
<li>「公判期日において供述することができない」</li>
</ul>
<p><span class="color-minty"><i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i></span> 「検察官面前調書が作成され証拠請求されるに至った事情や、供者が国外にいることになった事由のいかんによっては」 検察官面前調書の証拠能力が否定されるべき場合がありうる。 * 手続的正義の観点から公正さを欠く場合（∵憲法37条2項が証人審問権を保障している） * 被告人側の不利益：証人審問権、手続上の不公正</p>
<pre><code>  対立利益：真実の発見、事案の真相解明

  []{.color-minty} この比較衡量によって判断するのだから、退去強制の一事だけで決まるものではない</code></pre>
<ul>
<li><p>全面的供述拒否と一部記憶喪失（前段と後段）</p>
<ul>
<li>相反性が認められる場合には2つある</li>
</ul>
<p><span class="color-minty"><i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i></span> 他の証拠と相まって要証事実につき異なる認定を生ずる蓋然性がある場合</p>
<p><span class="color-minty"><i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i></span> 公判期日の証言によっては具体的な心証形成ができない場合</p></li>
<li><p>特信性：基本的には外部的付随事情（取調べ状況、公判の状況等）を考慮する。ただし、内容も外部的付随事情を推認させるために考慮要素として使うことはできる。</p>
<ul>
<li>客観的事実への合致は証明力判断であるから、証拠能力の判断段階で考慮すべきではない（現行法の立て付けに合わない）。</li>
</ul></li>
</ul></li>
<li><p>検証調書・鑑定書（321条3項）</p>
<ul>
<li>実況見分調書にも同項の適用がある。</li>
</ul></li>
<li><p>弾劾証拠（328条）※非伝聞証拠の確認規定</p>
<ul>
<li>「公判準備または公判期日における被告人、証人その他の者の供述が、別の機会にしたその者の供述と矛盾する場合に、<u>矛盾する供述をしたこと自体の立証を許すことにより公判準備または公判期日におけるその者の供述の信用性の減殺を図る</u> ことを許容する趣旨」</li>
<li>自己矛盾供述にのみ適用</li>
<li>補助事実についても厳格な証明が必要なのか？</li>
</ul>
<p><span class="color-minty"><i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i></span> 主要事実や間接事実の認定に直接重大な影響を及ぼす重要な証拠であるため、自由な証明では足りないと考えるのは一つの方法だが、従来は <strong>自由な証明で足りる</strong> と考えられてきた（実務家はこれを維持したい）。</p>
<ul>
<li>増強証拠の可否 <span class="color-minty"><i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i></span> 不可</li>
</ul>
<p><span class="math inline">\(\because\)</span> 経験則上 <u>要証事実を立証することに使えないので関連性が否定される</u> 上、仮に、捜査段階で言っていた供述内容が信用できるから、同じ内容の公判証言も信用できるのだというロジックを取ろうとすると、それは公判外の供述内容の真実性の話になので、伝聞法則の潜脱だから許されない。</p></li>
<li><p>写真、録音テープ、ビデオ</p>
<ul>
<li>関連性（ある証拠から <u>最終的な立証命題までを経験則に従って推認していくことができるか</u> と、<u>最終的な立証命題が本件の訴訟の結論に影響するか</u> の2つのレベルがありうる）</li>
<li>検証調書等に添付される写真：検証調書等の説明的供述部分を補完する趣旨のもので、検証調書に添付された写真は検証調書に記載された供述の一部として取り込まれているから、供述調書として扱われる。
<ul>
<li>添付写真の事件との関連性は、説明部分の証拠能力があることによって初めて基礎付けられるから、検証調書の他の叙述の証拠能力に従う。</li>
</ul></li>
</ul></li>
<li><p>再現実況見分調書（いわゆる現場指示と現場供述の違い）</p>
<ul>
<li>立会人の指示説明は実況見分の一つの手段に止まるにすぎないので、結局実況見分の結果を記載するのに他ならない。あくまで手がかりであって実況見分の動機を基礎付けるものにすぎない。</li>
</ul>
<p>e.g., 「ここで轢きました」 <span class="color-minty"><i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i></span> ブレーキ痕発見 <span class="color-minty"><i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i></span> 実況見分調書へ記録（なぜブレーキ痕を検証したかを示すために被告人の供述を記載する）</p></li>
</ul>
</section>
</section>
<section id="違法収集証拠" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="違法収集証拠"><span class="header-section-number">7</span> 違法収集証拠</h2>
<ul>
<li><p>適正手続の保障・司法の廉潔性・将来の違法捜査の抑止</p>
<p><span class="color-minty"><i class="fa-solid fa-arrow-right" aria-label="arrow-right"></i></span> 違法収集証拠排除法則</p>
<ul>
<li>適正手続の要請（憲法35条、31条）を直接の根拠とするのではなく、その趣旨を考慮している。</li>
<li>違法収集証拠の証拠能力はあくまで刑訴法の解釈に委ねられている。</li>
</ul></li>
<li><p>考慮要素：<strong>①手続違反の程度、②手続違反のなされた状況、③手続違反の有意性（捜査機関の意図）、④手続違反の頻発性、⑤事件の重大性</strong></p>
<ul>
<li>強制捜査であると違法かどうかとその程度を区別する実益が出てくる。</li>
</ul></li>
<li><p>「①令状主義の精神を没却するような重大な違法があり（違法の重大性）</p>
<p>⏪司法の廉潔性維持：軽微な違法のある証拠についてもどんどん排除するような司法を国民は信頼してくれないが、一方で重大な違法のある証拠について採用すればこれまた国民の信頼を害する（違法の重大性によって司法の廉潔性が傷つけられる程度が違う　※利益衡量の臨界点</p>
<p>②これを証拠として許容することが、将来における違法な捜査の抑制の見地からして相当でない（排除相当性）と認められる場合」</p>
<p>⏪将来の違法捜査の抑止と真相解明の必要性との比較衡量</p></li>
<li><p>①違法性の承継</p>
<ul>
<li><u>一連の違法な手続によりもたらされた状態を直接利用してなされる手続</u> は違法性を承継する。</li>
<li>違法収集証拠排除法則の2要件は、後続の手続に適用される。</li>
<li>違法行為と証拠との間に厳密な因果関係を必要とするわけではない。とはいえ、時間的な先後関係のみで限界づけるわけでもない。</li>
</ul></li>
<li><p>②毒樹の果実論</p>
<ul>
<li>理由：①違法収集証拠排除法則の骨抜きを防ぐ②捜査というものが連続した繋がりをもつ手続きである以上、その範囲が広汎になりすぎる恐れ</li>
<li>考慮要素（通説）：第一次証拠の獲得手続の違法の程度、第一次証拠と派生証拠との関連性の程度、証拠の重要性、事案の重大性</li>
</ul></li>
<li><p>③川出説</p>
<ul>
<li><u>違法な手続と証拠との（密接な）関連性</u> を問題にする。</li>
<li>違法収集証拠排除法則の2要件は先行する手続に適用される。</li>
<li>相互排他的な基準ではない。</li>
</ul></li>
<li><p>④強制処分が介在する場合には、違法収集証拠1による令状発布が違法となって捜索bが違法になる。</p></li>
</ul>
</section>
<section id="裁判" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="裁判"><span class="header-section-number">8</span> 裁判</h2>
<section id="概括的認定択一的認定" class="level3" data-number="8.1">
<h3 data-number="8.1" class="anchored" data-anchor-id="概括的認定択一的認定"><span class="header-section-number">8.1</span> 概括的認定・択一的認定</h3>
<ul>
<li><p>同一構成要件内：「罪となるべき事実」の特定がなされればよい（訴因の特定の問題と共通）。</p></li>
<li><p>異なる構成要件にまたがる場合</p>
<ul>
<li>問題</li>
</ul>
<p>①利益原則違反：それぞれについて合理的な疑いを挟まない程度の証明がないにもかかわらず、「AまたはB」の関係にして処罰することは利益原則に反する。</p>
<p>②罪刑法定主義違反：2つの犯罪を1つの罪名として考えることになり、新たな構成要件（合成的構成要件）を作り出してしまう</p>
<ul>
<li>同意殺人と殺人、死体遺棄と保護責任者遺棄（論理的な択一関係にある場合には、軽い方の罪を認定して良いのか？）</li>
</ul></li>
<li><p>①証明の単位を超えるような択一的認定</p>
<ul>
<li>利益原則との関係：実務家の間では重い罪に利益原則を適用して事実を擬制すれば、軽い罪で有罪認定できるという風な考え方が有力な一方、学説は一般にこういう事実擬制に批判的であって、大澤先生を中心に利益原則は事実の擬制をもたらすものではないのであって、むしろ刑法解釈を捉え直すべきだという主張をなされる。</li>
<li>罪刑法定主義との関係：罪刑法定主義が国民への処罰範囲の告知のみなのであれば、異なる構成要件間で択一的認定をしても罪刑法定主義には反しないという風な結論が出てくるが、それに留まらずに法定主義というところに重みをもたせて、立法府が構成要件ごとに刑罰権を設定するというところまで含むのだと考えると、異なる構成要件間で択一的認定をするというのは、裁判所が勝手に構成要件を作ることになるので、やはり罪刑法定主義違反となる。</li>
</ul></li>
<li><p>②証明の単位内の択一的認定（堂々と択一的認定を行って良い）</p></li>
<li><p>証明の単位：利益原則の適用単位が構成要件（多数説）　or 訴因（川出先生）。</p></li>
</ul>
</section>
<section id="一事不再理効" class="level3" data-number="8.2">
<h3 data-number="8.2" class="anchored" data-anchor-id="一事不再理効"><span class="header-section-number">8.2</span> 一事不再理効</h3>
<ul>
<li><p>有罪判決の内容的確定力：有罪判決が示された犯罪自体に及ぶ</p></li>
<li><p>一事不再理効：検察官が設定する訴因に基づいて判断される。公訴事実の同一性のある範囲で訴因変更というのが認められて、その範囲であれば審理される危険というのはあるから、<u>公訴事実の同一性の範囲で一事不再理効の効力が及ぶかどうか</u> を判断すべき。</p>
<ul>
<li>根拠：憲法39条の二重の危険の解釈</li>
<li>有罪判決の内容的確定力が及ぶ範囲と公訴事実の同一性の範囲で一事不再理効が及ぶ範囲がずれる。</li>
<li>両訴因の処罰をしようとする場合→公訴事実の単一性（牽連犯で一罪と評価されるので変更可能）</li>
</ul></li>
<li><p>単純窃盗と常習窃盗</p>
<ul>
<li>前訴と後訴の公訴事実の同一性によって判断。それぞれの訴因のみを基準として比較対照することによって行う。</li>
</ul>
<p>①検察官の訴因を尊重するべき（訴追裁量権）</p>
<p>②それぞれの行為の独立性も強いので、検察官がそれぞれに起訴することにも合理的な理由がある（常習特殊窃盗の性質）</p>
<ul>
<li>ただし、一方の訴因が常習窃盗罪である場合には、<u>訴因自体において一方の単純窃盗罪が他方の常習窃盗罪と実体的に一罪を構成するかどうかにつき検討すべき契機が存在する</u> として、単純窃盗罪が常習性の発露として行われたか否かについて付随的に心証形成する必要がある。</li>
</ul></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/Legal-Dragoman\.github\.io\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          trigger: 'click',
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          positionFixed: true,
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>